{% extends 'core/base_dashboard.html' %}
{% load static %}

{% block title %}Add User - Admin Console{% endblock %}
{% block page_title %}New System User{% endblock %}

{% block sidebar %}
    {% include 'core/includes/admin_sidebar.html' %}
{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'core/css/admin_forms.css' %}">
{% endblock %}

{% block content %}
<div class="card form-card">
    <div style="margin-bottom: 32px; text-align: center;">
        <div style="width: 56px; height: 56px; background: #eff6ff; color: var(--primary); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin: 0 auto 16px;">
            <i class="fas fa-user-plus"></i>
        </div>
        <h1 style="font-size: 1.5rem; font-weight: 700;">Create Account</h1>
        <p style="color: var(--text-muted); margin-top: 4px;">Register a new user to the EcoDrop platform</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert {% if message.tags == 'error' %}alert-error{% else %}alert-success{% endif %}">
                <i class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% else %}fa-check-circle{% endif %}"></i>
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <form method="POST">
        {% csrf_token %}
        
        <div class="form-grid">
            <div class="form-group">
                <label>Username *</label>
                <input type="text" name="username" class="form-control" required placeholder="">
            </div>
            
            <div class="form-group">
                <label>Password *</label>
                <input type="password" name="password" class="form-control" required placeholder="••••••••">
            </div>
            
            <div class="form-group">
                <label>First Name</label>
                <input type="text" name="first_name" class="form-control" placeholder="">
            </div>
            
            <div class="form-group">
                <label>Last Name</label>
                <input type="text" name="last_name" class="form-control" placeholder="">
            </div>
            
            <div class="form-group full-width">
                <label>Email Address</label>
                <input type="email" name="email" class="form-control" placeholder="">
            </div>
            
            <div class="form-group">
                <label>Account Category *</label>
                <select name="user_type" id="user_type" class="form-control" onchange="toggleIdFields()">
                    <option value="student">Student</option>
                    <option value="teacher">Teacher / Faculty</option>
                    <option value="staff">Administrative Staff</option>
                </select>
            </div>
            
            <div class="form-group" id="id_field_container">
                <label id="id_label">Student ID</label>
                <input type="text" name="school_id" id="school_id" value="{{ next_school_id }}" class="form-control" placeholder="C25-0001">
            </div>
        </div>
        
        <div class="form-actions">
            <a href="{% url 'admin_users' %}" class="btn btn-outline">Discard</a>
            <button type="submit" class="btn btn-primary">Create Account</button>
        </div>
    </form>
</div>

<script>
    function toggleIdFields() {
        const userType = document.getElementById('user_type').value;
        const container = document.getElementById('id_field_container');
        const label = document.getElementById('id_label');
        const input = document.getElementById('school_id');
        
        container.style.display = 'block';
        
        if (userType === 'student') {
            label.textContent = 'Student ID';
            input.name = 'school_id';
            input.value = "{{ next_school_id }}";
        } else if (userType === 'teacher') {
            label.textContent = 'Faculty ID';
            input.name = 'faculty_id';
            input.value = "{{ next_faculty_id }}";
        } else {
            container.style.display = 'none';
        }
    }
    
    toggleIdFields();
</script>
{% endblock %}

